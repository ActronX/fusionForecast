[station]
# Geographic location and PV system orientation
latitude = 52.5200    # Decimal latitude (Example: Berlin)
longitude = 13.4050   # Decimal longitude
tilt = 30             # Panel tilt in degrees (0=flat)
# Azimuth: 0=South, -90=East, 90=West, 180=North
azimuth = 0           # Orientation angle
altitude = 0          # Station altitude in meters

[influxdb]
# InfluxDB connection details
url = "http://localhost:8086" # Server URL
token = "YOUR_INFLUXDB_TOKEN_HERE" # API access token
org = "your_org"              # Organization name

[influxdb.buckets]
# Centralized data mapping (Buckets)
history_produced = "energy_data"   # Past PV generation data
regressor_history = "weather_data" # Historical weather data
regressor_future = "weather_data"  # Weather forecast data
target_forecast = "forecast_results" # Prediction output destination
live = "energy_meter"              # Real-time production for intraday correction (lagged regressor)

[influxdb.measurements]
# Measurement names for different data categories
produced          = "energy_meter"        # Source for actual PV production | ref: buckets.history_produced
regressor_history = "weather"             # Source for historic weather | ref: buckets.regressor_history
regressor_future  = "weather"             # Source for weather forecasts | ref: buckets.regressor_future
forecast          = "production_forecast" # Output for model predictions | ref: buckets.target_forecast
live              = "energy_meter"        # Real-time data source | ref: buckets.live

[influxdb.fields]
# Data field mapping within measurements
# Format: field_name = "db_field" # Description | refs: buckets.<key> & measurements.<key>

produced = "power_produced"          # Actual PV power/energy produced | refs: buckets.history_produced & measurements.produced
forecast = "power_produced_forecast" # Final power production forecast | refs: buckets.target_forecast & measurements.forecast
live     = "production"              # Real-time power for lagged regressor | refs: buckets.live & measurements.live

# Weather/Regressor fields (Source: buckets.regressor_history/future | measurements.regressor_history/future)
regressor_history    = ["global_tilted_irradiance", "temperature_2m", "clearsky_ghi"]           # Historic total irradiance (training) | refs: buckets.regressor_history & measurements.regressor_history
regressor_future     = ["global_tilted_irradiance", "temperature_2m", "clearsky_ghi"]           # Forecast total irradiance (prediction) | refs: buckets.regressor_future & measurements.regressor_future

[weather.open_meteo.historic]
# Historic Data Fetch Settings
start_date = "2024-01-01" # Start date for training history (YYYY-MM-DD)
end_date = "today"        # End date for training history
models = "best_match"      # Weather model selection
minutely_15 = ["global_tilted_irradiance_instant", "diffuse_radiation", "direct_normal_irradiance"] # 15min resolution variable

[weather.open_meteo.forecast]
# Future Forecast Fetch Settings
forecast_days = 14                             # Number of days to predict
models = "best_match"                          # Model selection
minutely_15 = ["global_tilted_irradiance_instant", "diffuse_radiation", "direct_normal_irradiance"] # 15min resolution variable

[model]
# Central model parameters and storage
path = "models/prophet_model.pkl" # File path to save/load trained model
training_days = 30               # Days of data to use for training
forecast_days = 14                # Prediction horizon in days

[model.preprocessing]
# Data cleaning, scaling and alignment
max_power_clip = 6000 # Max system output in Watts (physical limit)
produced_scale = 1.0  # Multiplier for production data
regressor_scale = 1.0 # Multiplier for weather data
produced_offset = "-30m" # Align production timestamps
regressor_offset = "0m"  # Align weather timestamps
forecast_offset = "0m"   # Shift output timestamps
night_threshold = 50     # Ignore values <= this (Watts)

[model.neuralprophet]
# NeuralProphet specific forecasting settings
yearly_seasonality = false        # PV is consistent daily, yearly matters but can be simple
weekly_seasonality = false        # Weekly patterns less relevant for PV?
daily_seasonality = true          # Strong daily cycle for PV
seasonality_mode = "additive"     # Additive is often simpler/stable
growth = "off"                    # Disable trend for PV (often stationary enough or handled by seasonality)

learning_rate = 0.01             # Explicit LR based on tuning (Auto was unreliable)
# epochs = null                    # Enable NeuralProphet auto epochs
batch_size = 256                  # Batch size for training (reduced to allow proper Auto-LR finding)
# Regularization parameters
seasonality_reg = 0.0
ar_reg = 0.05                      # AutoRegressive regularization
regressor_mode = "additive"       # Regressor mode: "additive" or "multiplicative"
accelerator = "auto" # "cpu", "gpu", or "auto"
loss_func = "Huber"  # "Huber", "MAE", or "MSE"

# Network Architecture (Deep Learning Configuration)
n_lags = 96                # 24 hours context (96 * 15min)
n_forecasts = 96           # Predict 24 hours at once (96 * 15min)
ar_days = -1                # Days to use AR for (1 = only first day, 0 = disable AR, -1 = always)
ar_layers = []             # Linear AR (no hidden layers) - Sufficient for this data!
