# InfluxDB Connection Settings
# Replace with your actual InfluxDB credentials and details.
# This file should be git-ignored and managed via a secret management system in production.

[influxdb]
# URL of the InfluxDB instance (e.g., http://localhost:8086)
url = "http://localhost:8086"
# API Token for authentication (requires read/write permissions for the specified buckets)
token = "YOUR_INFLUXDB_TOKEN_HERE"  # Replace with your InfluxDB API Token
# Organization name in InfluxDB
org = "your_org"              # Replace with your InfluxDB Organization

[buckets]
# Bucket containing historical production data (PV generation) for training
b_history_produced = "energy_data"

# Bucket containing historical regressor data (e.g., historical weather forecasts/measurements)
b_regressor_history = "weather_data"

# Bucket containing future regressor data (e.g., weather forecasts) for prediction
b_regressor_future = "weather_data"  

# Bucket where the generated production forecasts will be written
b_target_forecast = "forecast_results"


[measurements]
# Measurement name for production data (PV)
m_produced = "energy_meter"
# Measurement name for historical regressor data
m_regressor_history = "weather"
# Measurement name for future regressor data
m_regressor_future = "weather"      
# Measurement name for the output production forecast
m_forecast = "production_forecast"


[fields]
# Field name for produced energy/power
f_produced = "power_produced"

# Field name for historical regressor value (Irradiance)
f_regressor_history = "irradiance"
# Field name for future regressor value (Irradiance)
f_regressor_future = "irradiance"         
# Field name for the output production forecast value
f_forecast = "power_produced_forecast"


[model]
# Path to store the serialized Prophet model for production
model_path = "models/prophet_model.pkl"

[forecast_parameters]
# Number of days of historical data to use for training (e.g., 731 = 2 years + 1 day)
training_days = 731
# specific horizon for the forecast in days (how far ahead to predict)
forecast_days = 14



[preprocessing]
# Maximum allowed value for power/energy data (Physical maximum of PV system/Inverter); values above this are clipped
max_power_clip = 6000
# Multiplier for produced data (e.g., 1000.0 to convert kW to W)
produced_scale = 1.0
# Multiplier for regressor data (normalization or unit conversion)
regressor_scale = 1.0
# Time offset applied to regressor data (e.g. "-1h" shifts data back 1 hour). "0m" for no offset.
regressor_offset = "0m"
# Time offset applied to produced data before training. "0m" for no offset.
produced_offset = "-30m"
# Time offset applied to the final forecast timestamps. "0m" for no offset.
forecast_offset = "0m"


[prophet]
# --- Production Model Settings ---
# influence of the external regressor on the model (Higher = stronger influence)
regressor_prior_scale = 5.0 
# Flexibility of the trend component (Higher = more flexible, Lower = smoother)
# Tuned value: 0.001 - Very stiff trend (avoids overfitting to short-term changes)
changepoint_prior_scale = 0.001
# Flexibility of the seasonality component (Higher = more flexible/complex seasonality)
seasonality_prior_scale = 1.0 
# Mode for seasonality: "additive" (constant amplitude) or "multiplicative" (amplitude changes with trend)
seasonality_mode = "additive"
# Mode for regressor impact: "additive" or "multiplicative"
regressor_mode = "additive"
# Enable yearly seasonality (only if >1 year of data available)
yearly_seasonality = true


[prophet.tuning]
# --- Hyperparameter Tuning Settings ---
# Number of CPU cores to use for parallel tuning jobs
process_count = 6
# Threshold value (in Watts) to ignore/filter out night values during evaluation
night_threshold = 50

# Parameter grid for 'changepoint_prior_scale'
changepoint_prior_scale = [0.001, 0.01, 0.1]
# Parameter grid for 'seasonality_prior_scale'
seasonality_prior_scale = [0.1, 1.0, 10.0]
# Parameter grid for 'regressor_prior_scale'
regressor_prior_scale = [0.1, 0.5, 1.0, 3.0, 5.0]

# Parameter grid for 'regressor_mode'
regressor_mode = ["additive", "multiplicative"]
# Parameter grid for 'seasonality_mode'
seasonality_mode = ["additive", "multiplicative"]

[open_meteo]
# --- Open-Meteo API Shared Settings ---
# Latitude of the location
latitude = 52.5200
# Longitude of the location
longitude = 13.4050
# Tilt angle of the solar panels (degrees)
tilt = 30
# Azimuth angle of the solar panels (degrees, 0 = South or North depending on convention, Open-Meteo uses 0=South?) check docs
# Open-Meteo: 0=South, -90=East, 90=West. 180=North.
azimuth = 0


[open_meteo.historic]
# --- Historic Data Fetch Settings ---
# API Endpoint for historical forecast data
url = "https://historical-forecast-api.open-meteo.com/v1/forecast"
# Start date for fetching historical data (YYYY-MM-DD)
start_date = "2024-01-01"
# End date for fetching historical data (YYYY-MM-DD or "today")
end_date = "today"
# Weather models to use (e.g., "icon_d2", "best_match")
models = "best_match"
# 15-minute variable to fetch
minutely_15 = "global_tilted_irradiance_instant"

[open_meteo.forecast]
# --- Future Forecast Fetch Settings ---
# API Endpoint for current forecast data
url = "https://api.open-meteo.com/v1/forecast"
# Number of days to forecast into the future
forecast_days = 14
# Weather models to use (e.g., "icon_d2", "best_match")
models = "best_match"
# 15-minute variable to fetch
minutely_15 = "global_tilted_irradiance_instant"


[nowcast]
# Bucket containing live production data
bucket_live = "energy_meter"
# Measurement name for live production data (PV)
measurement_live = "energy_meter"
# Field name for live production power
field_live = "production"
# Enable damping factor calculation based on recent performance
use_damping_factor = true
# Measurement name for the nowcast output
m_nowcast = "nowcast"
