[station]
# Geographic location and PV system orientation
latitude = 52.5200    # Decimal latitude (Example: Berlin)
longitude = 13.4050   # Decimal longitude
tilt = 30             # Panel tilt in degrees (0=flat)
# Azimuth: 0=South, -90=East, 90=West, 180=North
azimuth = 0           # Orientation angle
altitude = 0          # Station altitude in meters

[influxdb]
# InfluxDB connection details
url = "http://localhost:8086" # Server URL
token = "YOUR_INFLUXDB_TOKEN_HERE" # API access token
org = "your_org"              # Organization name

[influxdb.buckets]
# Centralized data mapping (Buckets)
history_produced = "energy_data"   # Past PV generation data
regressor_history = "weather_data" # Historical weather data
regressor_future = "weather_data"  # Weather forecast data
regressor_history_2 = ""           # 2nd regressor source (historic) | "" to disable
regressor_future_2  = ""           # 2nd regressor source (future)  | "" to disable
target_forecast = "forecast_results" # Prediction output destination
live = "energy_meter"              # Real-time production for intraday correction (lagged regressor)
batterie = "batterie"              # Battery data bucket

[influxdb.measurements]
# Measurement names for different data categories
produced          = "energy_meter"        # Source for actual PV production | ref: buckets.history_produced
regressor_history = "weather"             # Source for historic weather | ref: buckets.regressor_history
regressor_future  = "weather"             # Source for weather forecasts | ref: buckets.regressor_future
regressor_history_2 = ""                  # 2nd source measurement | ref: buckets.regressor_history_2
regressor_future_2  = ""                  # 2nd source measurement | ref: buckets.regressor_future_2
forecast          = "production_forecast" # Output for model predictions | ref: buckets.target_forecast
live              = "energy_meter"        # Real-time data source | ref: buckets.live

[influxdb.fields]
# Data field mapping within measurements
# Format: field_name = "db_field" # Description | refs: buckets.<key> & measurements.<key>

produced = "power_produced"          # Actual PV power/energy produced | refs: buckets.history_produced & measurements.produced
forecast = "power_produced_forecast" # Final power production forecast | refs: buckets.target_forecast & measurements.forecast
live     = "production"              # Real-time power for lagged regressor | refs: buckets.live & measurements.live

# Weather/Regressor fields (Source: buckets.regressor_history/future | measurements.regressor_history/future)
regressor_history    = ["global_tilted_irradiance", "temperature_2m", "snow_depth", "wind_speed_10m"]           # Historic total irradiance (training) | refs: buckets.regressor_history & measurements.regressor_history
regressor_future     = ["global_tilted_irradiance", "temperature_2m", "snow_depth", "wind_speed_10m"]           # Forecast total irradiance (prediction) | refs: buckets.regressor_future & measurements.regressor_future
regressor_history_2  = []                                                                                      # 2nd source fields (historic) | refs: buckets.regressor_history_2
regressor_future_2   = []                                                                                      # 2nd source fields (future)  | refs: buckets.regressor_future_2


[weather.open_meteo.historic]
# Historic Data Fetch Settings
start_date = "2023-12-01" # Start date for training history (YYYY-MM-DD)
end_date = "today"        # End date for training history
models = "best_match"      # Weather model selection
minutely_15 = ["diffuse_radiation", "direct_normal_irradiance"] # 15min resolution variables
hourly = ["temperature_2m", "snow_depth", "wind_speed_10m"]


[weather.open_meteo.forecast]
# Future Forecast Fetch Settings
forecast_days = 14                            # Number of days to predict
models = "best_match"                          # Model selection
minutely_15 = ["diffuse_radiation", "direct_normal_irradiance"] # 15min resolution variables
hourly = ["temperature_2m", "snow_depth", "wind_speed_10m"]

[model]
# Central model parameters and storage
path = "models/prophet_model.pkl" # File path to save/load trained model
training_days = 30               # Days of data to use for training
forecast_days = 14                # Prediction horizon in days

[model.preprocessing]
# Data cleaning, scaling and alignment
max_power_clip = 6000 # Max system output in Watts (physical limit)
produced_scale = 1.0  # Multiplier for production data
regressor_scale = 1.0 # Multiplier for weather data
produced_offset = "-30m" # Align production timestamps
regressor_offset = "0m"  # Align weather timestamps
forecast_offset = "0m"   # Shift output timestamps
nighttime_elevation_threshold = 2.0 # Threshold for solar elevation below which production is zeroed

[model.neuralprophet]
# NeuralProphet specific forecasting settings
# Based on: https://neuralprophet.com/how-to-guides/application-examples/energy_solar_pv.html

# Seasonality Configuration
yearly_seasonality = false        # PV is consistent daily, yearly handled by AR/regressors
weekly_seasonality = false        # Weekly patterns less relevant for PV
daily_seasonality = true          # Strong daily cycle for PV
seasonality_mode = "additive"     # Additive is simpler/more stable

# Trend Configuration
growth = "off"                    # Disable trend - recommended for pure AR-based PV forecasting

# Training Parameters
# NOTE: learning_rate is now DYNAMIC in train.py:
#   - 0.003 when ar_layers is non-empty (prevents gradient vanishing)
#   - Auto (null) when ar_layers is empty (linear model)
# Set explicit value here to override, or leave null for auto-detection
# learning_rate = (not set)        # Let train.py determine based on ar_layers

# epochs = null                   # Enable NeuralProphet auto epochs
batch_size = 128                  # Batch size for training

# Regularization Parameters
seasonality_reg = 0.0             # Seasonality regularization (0.1-100, higher = more dampening)
ar_reg = 1.0                       # AR sparsity: 0.1=light, 1.0=moderate, 10=extreme (unstable)

# Regressor Configuration
regressor_mode = "additive"       # Regressor mode: "additive" or "multiplicative"

# Hardware Acceleration
accelerator = "auto"              # "cpu", "gpu", or "auto"

# Loss Function
loss_func = "Huber"               # "Huber" (robust to outliers), "MAE", or "MSE"

# AR-Net Architecture (Deep Learning Configuration)
# Per docs: n_lags should be >= n_forecasts for effective AR
n_lags = 192                       # 72 hours context (288 * 15min = 72h)
n_forecasts = 96                  # Predict 24 hours at once (96 * 15min = 24h)

# AR Hidden Layers
# [] = Linear AR (simpler, often sufficient for PV)
# [64] = Single hidden layer with 64 neurons (more complex patterns)
# [32,32,32,32] = Deep AR-Net (used in Solar PV docs example)
ar_layers = []                    # Linear AR - sufficient for most PV forecasting