[station]
# Geographic location and PV system orientation
latitude = 52.5200    # Decimal latitude (Example: Berlin)
longitude = 13.4050   # Decimal longitude
tilt = 30             # Panel tilt in degrees (0=flat)
# Azimuth: 0=South, -90=East, 90=West, 180=North
azimuth = 0           # Orientation angle

[influxdb]
# InfluxDB connection details
url = "http://localhost:8086" # Server URL
token = "YOUR_INFLUXDB_TOKEN_HERE" # API access token
org = "your_org"              # Organization name

[influxdb.buckets]
# Centralized data mapping (Buckets)
history_produced = "energy_data"   # Past PV generation data
regressor_history = "weather_data" # Historical weather data
regressor_future = "weather_data"  # Weather forecast data
target_forecast = "forecast_results" # Prediction output destination
live = "energy_meter"              # Real-time production for nowcasting

[influxdb.measurements]
# Measurement names for different data categories
produced          = "energy_meter"        # Source for actual PV production | ref: buckets.history_produced
regressor_history = "weather"             # Source for historic weather | ref: buckets.regressor_history
regressor_future  = "weather"             # Source for weather forecasts | ref: buckets.regressor_future
forecast          = "production_forecast" # Output for model predictions | ref: buckets.target_forecast
live              = "energy_meter"        # Real-time data source | ref: buckets.live
nowcast           = "nowcast"             # Output for nowcast adjustments | ref: buckets.target_forecast

[influxdb.fields]
# Data field mapping within measurements
# Format: field_name = "db_field" # Description | refs: buckets.<key> & measurements.<key>

produced = "power_produced"          # Actual PV power/energy produced | refs: buckets.history_produced & measurements.produced
forecast = "power_produced_forecast" # Final power production forecast | refs: buckets.target_forecast & measurements.forecast
live     = "production"              # Real-time power for nowcasting | refs: buckets.live & measurements.live

# Weather/Regressor fields (Source: buckets.regressor_history/future | measurements.regressor_history/future)
regressor_history    = "irradiance"           # Historic total irradiance (training) | refs: buckets.regressor_history & measurements.regressor_history
regressor_future     = "irradiance"           # Forecast total irradiance (prediction) | refs: buckets.regressor_future & measurements.regressor_future

[weather.open_meteo.historic]
# Historic Data Fetch Settings
url = "https://historical-forecast-api.open-meteo.com/v1/forecast" # History API endpoint
start_date = "2024-01-01" # Start date for training history (YYYY-MM-DD)
end_date = "today"        # End date for training history
models = "best_match"      # Weather model selection
minutely_15 = "global_tilted_irradiance_instant" # 15min resolution variable

[weather.open_meteo.forecast]
# Future Forecast Fetch Settings
url = "https://api.open-meteo.com/v1/forecast" # Forecast API endpoint
forecast_days = 14                             # Number of days to predict
models = "best_match"                          # Model selection
minutely_15 = "global_tilted_irradiance_instant" # 15min resolution variable

[model]
# Central model parameters and storage
path = "models/prophet_model.pkl" # File path to save/load trained model
training_days = 30               # Days of data to use for training
forecast_days = 14                # Prediction horizon in days

[model.preprocessing]
# Data cleaning, scaling and alignment
max_power_clip = 6000 # Max system output in Watts (physical limit)
produced_scale = 1.0  # Multiplier for production data
regressor_scale = 1.0 # Multiplier for weather data
produced_offset = "-30m" # Align production timestamps
regressor_offset = "0m"  # Align weather timestamps
forecast_offset = "0m"   # Shift output timestamps

[model.neuralprophet]
# NeuralProphet specific forecasting settings
yearly_seasonality = false        # Enable annual cycles
weekly_seasonality = false        # Weekly patterns
daily_seasonality = true          # Daily patterns
seasonality_mode = "additive"    # Saisonal effect type
growth = "off"                    # Disable trend

# learning_rate = null             # Enable NeuralProphet auto learning rate
# epochs = null                    # Enable NeuralProphet auto epochs
batch_size = 2048                  # Batch size for training
# Regularization (0.0 = no regularization)
seasonality_reg = 0.005
ar_reg = 0.1                      # AutoRegressive regularization
regressor_mode = "multiplicative"       # Regressor mode: "additive" or "multiplicative"
accelerator = "auto" # "cpu", "gpu", or "auto"

# Network Architecture (Deep Learning Configuration)
n_lags = 96              # 24 hours context (96 * 15min)
n_forecasts = 96         # Predict 24 hours at once (96 * 15min)
ar_layers = [64, 32]     # Deep AR-Net: Two hidden layers [64, 32]

[model.tuning]
# Hyperparameter optimization settings (now uses Optuna)
trials = 100             # Number of intelligent search trials
process_count = 1       # Number of parallel CPU cores
night_threshold = 50    # Ignore values <= this during evaluation (Watts)
# Note: Optuna now searches ranges automatically. 
# You no longer need to define static grids here.

[nowcast]
# Real-time adjustment (damping factor) settings
use_damping_factor = true  # Enable real-time correction based on actuals
min_damping_factor = 0.3  # Minimum allowed adjustment factor
max_damping_factor = 1.5   # Maximum allowed adjustment factor
